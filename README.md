# Система управления и контроля бизнеса

### Backend-часть приложения разделена на несколько микросервисов:
1. [Взаимодействие с пользователями (регистрация, аутентификация, обновление информации и т.д.)](https://github.com/Harukakuraharu/BusinessControl/tree/main/api_user)
2. [Взаимодействие с компаниями и организациями, в т.ч. управление через админ-панель](https://github.com/Harukakuraharu/BusinessControl/tree/main/api_admin)
3. [Взаимодействие с задачами, мотивациями, встречами](https://github.com/Harukakuraharu/BusinessControl/tree/main/api_tasks)
4. [Взаимодействие с базами данных](https://github.com/Harukakuraharu/BusinessControl/tree/main/libs)

## Запуск приложения
Для начала, необходимо скачать репозиторий локально к себе на устройство
```
git clone git@github.com:Harukakuraharu/BusinessControl.git
```
<<<<<<< HEAD
После этого, в корневой директории необходимо создать файл *.env*, пример лежит в файле [env.example](https://github.com/Harukakuraharu/BusinessControl/blob/main/env.example).
=======
После этого, в корневой директории необходимо создать файл *.env*, пример лежит в файле [env.example]().
>>>>>>> e7f03f9 (Added docs)

## Команда для сборки и запуска приложения
```
docker compose up --build -d
```

## Приложения работают на разных хостах:
    Для работы с пользователями - http://127.0.0.1:8002/docs
    Для работы с компаниями и админ-панелью - http://127.0.0.1:8000/docs
    Для работы с задачами и встречами - http://127.0.0.1:8001/docs

    Админ-панель доступна по адресу - http://127.0.0.1:8000/admin_panel/

## Работа с приложением
Регистрироваться в приложении может любой пользователь, но, чтобы создавать компании (команды), задачи и управлять ими, у пользователя необходимо активировать параметр **is_admin**. 
Сделать такое может только владелец приложения, которого нужно создать через консоль.

После запуска приложения, нужно зайти внутрь контейнера **backend-user**:
```
docker compose exec backend-user sh
python manage.py create-admin
```
Далее, следуя инструкции, напишите почту, имя, фамилию и пароль для владельца приложения.

<<<<<<< HEAD
### *Только владелец приложения может разрешить пользователям создавать компании(команды), организации, задачи, добавлять пользователей в свою компанию и управлять админ-панелью.*
=======
### *Только владелец компании может разрешить пользователям создавать компании(команды), организации, задачи, добавлять пользователей в свою компанию и управлять админ-панелью.*
>>>>>>> e7f03f9 (Added docs)

Для того, чтобы добавлять задачи определенному пользователю или приглашать на встречи, нужно добавить этого пользователя в свою компанию(команду). 

Можно сделать это отдельной ручкой или прислать ему специльный код, который он может ввести после регистрации в приложении.
Код генерируется владельцами компаний и хранится определенное время, а так же содержит информацию в какую компанию его добавлять и с какой ролью. Соответственно, владельцы компаний с помощью кода автоматически приглашают пользователей в свою компанию(команду).


## Дополнительные команды
Если есть необходимость перезапустить определенные контейнеры:
```
docker compose up --build  --no-deps -d имя_контейнера
```
Eсли нужно остановить все контейнеры (флаг -v для удаления всех данных):
```
docker compose down -v
```
Eсли нужно открыть контейнер в консоли
```
docker compose exec имя_контейнера sh
```
Если нужно посмотртеть логи контейнера
```
docker compose logs имя_контейнера
```    

## Локальная разработка и запуск тестов
Если есть необходимость локально запустить конкретный микросервис, необходимо опустить **Docker** и следовать дальнейшей инструкции:
<<<<<<< HEAD
1. #### Так как сервисы используют одну базу данных, необходимо ее запустить, находясь в корневой директории проекта
```
docker compose -f docker-compose-db.yaml up --build  
```
Миграции применяются автоматически, т.к. прописаны в Dockerfile.

2. #### Для локального запуска конкретного микросервиса, необходимо открыть его как корневую директорию и создать в корне *.env*, пример лежит в файле *env.example* так же в корневой директории. 
3. #### Для каждого сервиса необходимо создать виртуальное окружение
=======
1. Для локального запуска конкретного микросервиса, необходимо открыть его как корневую директорию и создать в корне *.env*, пример лежит в файле [env.example] так же в корневой директории. 
2. Для каждого сервиса необходимо создать виртуальное окружение
>>>>>>> e7f03f9 (Added docs)
```
python -m venv .venv
```
Активация виртуальной среды для OC Linux
```
source .venv/bin/activate
```
Активация виртуальной среды для OC Windows
```
venv\Scripts\activate
```
<<<<<<< HEAD
4. #### Далее, нужно установить зависимости:
=======
3. Далее, нужно установить зависимости:
>>>>>>> e7f03f9 (Added docs)
```
pip install poetry
poetry install
```
<<<<<<< HEAD
5. #### Теперь любой сервис сможет подключиться к базе данных и функционировать полноценно. При необходимости запуск тестов происходит командой
```
pytest
```
=======
4. Так как сервисы используют одну базу данных, необходимо ее запустить, открыв как корневую директорию папку **libs/**, так же по примеру создать файл *.env*, создать виртуальное окружение и установить зависимости.
5. Для подключения баз данных, нужно поднять docker-compose.yaml
```
docker compose up --build
```
6. И применить миграции
```
alembic -c /database/migrations/alembic.ini upgrade head
```
7. Теперь любой сервис сможет подключиться к базе данных и функционировать полноценно.

#### Для запуска тестов, необходимо запускать их внутри каждого сервиса:
```
pytest
```
>>>>>>> e7f03f9 (Added docs)
